{% extends 'base.html' %}

{% block content %}
<div class="row mb-5">
    <div class="col-12 text-center">
        <h1 class="display-4">Freshly Brewed Experience</h1>
        <p class="text-muted">Select items to place your order</p>
    </div>
</div>

<div class="row g-4" id="menu-items">
    {% for item in menu %}
    <div class="col-md-4">
        <div class="card h-100 p-3 card-menu text-center">
            <h4 class="mb-1">{{ item[1] }}</h4>
            <span class="text-muted small mb-2">{{ item[3] }}</span>
            <div class="price-tag mb-3">${{ "%.2f"|format(item[2]) }}</div>
            <div class="d-flex align-items-center justify-content-center gap-2">
                <button class="btn btn-sm btn-outline-secondary btn-qty" data-dir="-1"
                    data-id="{{ item[0] }}">-</button>
                <span id="qty-{{ item[0] }}" class="fw-bold">0</span>
                <button class="btn btn-sm btn-outline-secondary btn-qty" data-dir="1" data-id="{{ item[0] }}">+</button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div id="floating-cart" data-bs-toggle="modal" data-bs-target="#cartModal">
    ðŸ›’ <span id="cart-count">0</span> Items in Cart
</div>

<!-- Cart Modal -->
<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Review Order</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <ul id="cart-list" class="list-group list-group-flush"></ul>
            </div>
            <div class="modal-footer">
                <form action="/place_order" method="POST" id="order-form">
                    <input type="hidden" name="cart" id="cart-input">
                    <button type="submit" class="btn btn-order">Place Order</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    let cart = {};

    document.querySelectorAll('.btn-qty').forEach(btn => {
        btn.addEventListener('click', () => {
            const id = btn.dataset.id;
            const dir = parseInt(btn.dataset.dir);
            if (!cart[id]) cart[id] = 0;
            cart[id] = Math.max(0, cart[id] + dir);
            document.getElementById(`qty-${id}`).innerText = cart[id];
            updateCart();
        });
    });

    function updateCart() {
        let totalItems = 0;
        let listContent = "";
        for (const [id, qty] of Object.entries(cart)) {
            if (qty > 0) {
                totalItems += qty;
                listContent += `<li class="list-group-item">Item #${id} x ${qty}</li>`;
            }
        }
        document.getElementById('cart-count').innerText = totalItems;
        document.getElementById('cart-list').innerHTML = listContent;
        document.getElementById('cart-input').value = JSON.stringify(cart);
    }
</script>
{% endblock %}